{%extends "indexx.html"%}
{% block title %}Aggregator Dashboard - Diagnostica Span{% endblock %}
{%block content%}
<div id="wrapper">
{%include "sidebarr.html"%}
    <div id="page-content-wrapper">
        <div class="container-fluid">
            <div class="row">
                <div class="col-lg-12">
                    <div class="float-end">
                        {% comment %} <div class="dropdown">
                            <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <i class="fa fa-user"></i>
                            </button>
                            <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                              <a class="dropdown-item" href="#">Logout</a>
                              <a class="dropdown-item" href="#">Another action</a>
                              <a class="dropdown-item" href="#">Something else here</a>
                            </div>
                        </div> {% endcomment %}

                        <div class="dropdown">
                            <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton1" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="fa fa-user"></i>
                            </button>
                            <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
                            <li><a class="dropdown-item" href={%url "aggregator-profile" %}>Profile</a></li>
                            <li><a class="dropdown-item" href={% url "aggregator-changepassword"%}>Change Password</a></li>
                            <li><a class="dropdown-item" href={% url "aggregator-logout"%}>Logout</a></li>
                              {% comment %} <li><a class="dropdown-item" href="#">Another action</a></li>
                              <li><a class="dropdown-item" href="#">Something else here</a></li> {% endcomment %}
                            </ul>
                          </div>
                    </div>
                    <div class="col-12 d-flex justify-content-between align-items-center py-3">
                        <form method="post">
                            {%csrf_token%}
                            <div class="d-flex">
                                <input type="text" name="searched" placeholder="search" class="form-control"/>
                                <button type="submit" class="btn-primary form-control w-50 ms-2">Search</button> 
                            </div>
                        </form>
                        <form method="post" id="datefilterr">
                            {%csrf_token%}
                            <div class="d-flex">
                                <div>
                                    <label for="fromdate">From Date</label>
                                    <input type="date" id="fromdate" name="fromdate" placeholder="From date" class="form-control"/>
                                </div>
                                <div class="ms-2">
                                    <label for="todate">To Date</label>
                                <input type="date" id="todate" name="todate" placeholder="To date" class="form-control"/>
                                </div>
                                <button type="submit" class="btn-primary form-control w-50 h-50 ms-2 mt-4">Search</button> 
                            </div>
                        </form>
                    {% comment %} <div class="float-end"> <a  href={% url "addform" %}><button class="btn-secondary form-control py-2 px-5 br-10"><i class="fa fa-plus"></i>Add</button></a></div> {% endcomment %}
                    </div> 
                    {%if count != 0%}
                    <table class="table table-striped">
                        <thead>
                          <tr>
                            <th>Booking Id</th>
                            {% comment %} <th>Tests</th> {% endcomment %}
                            <th>Payment Status</th>
                            <th>Price</th>
                            <th>Ordered Date</th>
                            <th>Paid Date</th>
                            <th></th>
                          </tr>
                        </thead>
                        <tbody>
                            {%for i in data%}
                          <tr>
                            <td>{{i.bookingid}}</td>
                            {% comment %} <td><a  target="blank" href="{{ bookhistory.prescription.url}}">{{bookhistory.bookingdetails|truncatechars:10}}</a></td> {% endcomment %}
                            {% comment %} <td data-label="Booking Details"><a href="{% url 'test-detailss' i.bookingid %}"><button class="br btn-secondary">Show Info</button></a></th> {% endcomment %}
                                {% comment %} <td data-label="Booking Details"><a href={% url "test-detailss" value={{i.bookingid}}%}><button class="br btn-secondary" id="{{i.bookingid}}" onclick="func('{{i.bookingid}}')">Show Info</button></a></th> {% endcomment %}
                            
                            {%if i.payment_status == True%}
                                <td><i class="fa fa-check" aria-hidden="true"></i></td>
                                {%else%}
                                <td><i class="fa fa-close" aria-hidden="true"></i></td>
                            {%endif%}


                            {%if i.price != None%}
                                <td>Rs {{i.price|floatformat:2}}</td>
                                {%else%}
                                <td> - </td>
                            {%endif%}

                            <td>{{i.created}}</td>

                            {%if i.paymentdate != None%}
                                <td>{{i.paymentdate}}</td>
                                {%else%}
                                <td> - </td>
                            {%endif%}
                            <td data-label="Booking Details"><a href="{% url 'test-detailss' i.bookingid %}"><button class="br btn-secondary">Show Info</button></a></th>
                          </tr>
                          {%endfor%}
                        </tbody>
                      </table>
                      {%else%}
                      <h1>No Records Found..</h1>
                      {%endif%}
                </div>
            </div>
        </div>
    </div>
</div>
{% comment %} <script>
    function func(ids){
        $.ajax({
            type:"POST",
            data:{
                "action":"testdetails",
                    "id":ids,
                    csrfmiddlewaretoken: '{{ csrf_token }}'
            },
            datatype:"json",
            success:function(resp){
                console.log()
            }
        })
    }
</script> {% endcomment %}
<script>
    jQuery.validator.addMethod("greaterThan", 
    function(value, element, params) {
    if (!/Invalid|NaN/.test(new Date(value))) {
        a=Date($(params).val())
        console.log(Date(value),a)
        return new Date(value) > new Date($(params).val());
    }
    return isNaN(value) && isNaN($(params).val()) 
        || (Number(value) > Number($(params).val())); 
},'Must be greater than From Date.');

$("#datefilterr").validate({
    rules: {
        todate: { greaterThan: "#fromdate" }
    }
});
</script>
{%endblock%}