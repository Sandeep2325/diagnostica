{% extends "index.html" %}
{% load static %}
{%block content%}

<body onload="setAttr()">
    {%include "header.html"%}
{%include "subheader.html"%}
    <section class="user_profile_pic">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="bg-light-grey pt-lg-5 pt-3">
                        <div class="card-body ">
                            <div class="profile-pic-wrapper form-group">
                                <div class="pic-holder">
                                    <!-- uploaded pic shown here -->
                                    {% if profile.photo %}
                                    <img id="profilePic" class="pic" src="{{profile.photo.url}}">
                                    {% else %}
                                    <img id="profilePic" class="pic" src="https://www.kindpng.com/picc/m/252-2524695_dummy-profile-image-jpg-hd-png-download.png">
                                    {% endif %}
                                    <label for="newProfilePhoto" class="upload-file-block">
                                        <div class="text-center">
                                            <div class="mb-2">
                                                <i class="fa fa-camera fa-2x"></i>
                                            </div>
                                            <div class="text-uppercase">
                                                Update <br /> Profile Photo
                                            </div>
                                        </div>
                                    </label>
                                    <Input class="uploadProfileInput" type="file" name="profile_pic"
                                        id="newProfilePhoto" accept="image/*" style="display: none;" />
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
    </section>
    <section class="section_profile pb-xl-5 pb-3">
        <div class="container">
            <div class="row">
                <form method="post" id="profileForm">
                    {%csrf_token%}
                    <div class="col-lg-12 ">
                        {%for message in messages%}
                        {{message}}
                        {%endfor%}
                        <div class="bg-light-grey px-xl-5">
                            <div class="row py-xl-5 px-xl-5 px-3">
                                <div class="col-lg-4 pt-3">
                                    <label class="fs-18 cl-dark-blue font-regular" for="name">Name</label>
                                    <input class="w-100 mt-2 br-5 cl-dark-blue fs-20  "
                                        placeholder="Enter your name" type="text" name="name" id="name"
                                        value={{profile.username}}>
                                </div>
                                <div class="col-lg-4 pt-3">
                                    <label class="fs-18 cl-dark-blue font-regular" for="email">Email ID</label>
                                    <input class="w-100 mt-2 br-5 cl-dark-blue fs-20 "
                                        placeholder="Enter your email" type="email" name="email" id="email"
                                        value={{profile.email}}>
                                </div>
                                <div class="col-lg-4 pt-3">
                                    <label class="fs-18 cl-dark-blue font-regular" for="phone">Mobile Number</label>
                                    <input class="w-100 mt-2 br-5 cl-dark-blue fs-20 "
                                        placeholder="Enter your mobile number" type="text" name="phone" id="phone"
                                        value={{profile.phone_no}}>
                                </div>
                            </div>
                            <div class="row pb-5 px-xl-5 px-3">
                                <div class="col-lg-4 pt-3">
                                    <label class="fs-18 cl-dark-blue font-regular" for="gender">Gender</label>

                                    <select class="w-100 mt-2 br-5 cl-dark-blue fs-20  br  form-select select_option"
                                        type="select" name="gender" id="gender">
                                        <option selected="selected" class="opc-5" disabled>{{profile.gender}}</option>
                                        <option value="Male">Male</option>
                                        <option value="Female">Female</option>
                                        <option value="Others">Others</option>
                                    </select>
                                    <!-- <input class=" w-100 mt-2 br-5 cl-dark-blue fs-20  "> -->
                                </div>
                                <div class=" col-lg-4 pt-3">
                                    <label class="fs-18 cl-dark-blue font-regular" for="location">Location</label>
                                    <input class="w-100 mt-2 br-5 cl-dark-blue fs-20 "
                                        placeholder="Enter Your Location" name="location" type="location" id="location"
                                        value={{profile.location}}>
                                </div>
                                <div class="col-lg-4 pt-3 pb-xl-5">
                                    <label class="fs-18 cl-dark-blue font-regular" for="date">Date of Birth</label>
                                    <input class="w-100 mt-2 br-5 cl-dark-blue fs-20 " type="date"
                                        value={{profile.dob}} name="date" id="date">
                                </div>
                                <div class="col-lg-12 pt-3 pb-xl-5  ">
                                    <label class="fs-18 cl-dark-blue font-regular" for="address">Address</label>
                                    <input class="w-100 h-100 mt-2 br-5 cl-dark-blue fs-20 " type="text"
                                        placeholder="Enter your address" type="address" name="address"
                                        value={{profile.address}} id="address">
                                </div>
                            </div>
                            <div class=" px-3 px-xl-5">
                                <button class="px-5 py-2 mb-lg-5 mb-3 bg-sky-blue br-5  fs-18  cl-dark-white br" type="submit"
                                    value="submit">Submit</button>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </section>
    {%include "footer.html"%}
</body>
{% comment %}
<script>
    $(document).ready(function () {

        $("#profileForm").submit(function (event) {
            var data = $("#profileForm").serialize();
            $.ajax({
                type: "POST",
                url: "{%url "profile" %}",
                data: {
                    data,
                    'csrfmiddlewaretoken': {% csrf_token %}
            },
                success: function () {
                    alert("Profile Updated Succesfully")
                }
          });
        return false; //<---- move it here
    });
      
      });
</script> {% endcomment %}
<script>
    jQuery.validator.addMethod("name_regex", function (value, element) {
        return this.optional(element) || /^[a-zA-z\.\-_]{1,30}$/i.test(value);
    }, "Enter valid name");
    jQuery.validator.addMethod("phone_regex", function (value, element) {
        return this.optional(element) || /^[0-9\.\-_]{10,30}$/i.test(value);
    }, "Enter valid phone number");

    $.validator.addMethod('filesize', function (value, element, param) {
        return this.optional(element) || (element.files[0].size <= param)
    }, 'File size must be less than {0}');
    $("#profileForm").validate({
        rules: {

            'name': {
                required: true,
                minlength: 1,
                name_regex: true,
            },
            'email': {
                required: true,
                email: true
            },
            'phone': {
                required: true,
                phone_regex: true,
                minlength: 10
            },
            'gender': {
                required: true,
            },
            'location': {
                required: true,
            },
            'date': {
                required: true,
                greaterThan: true

            },
            'address': {
                required: true,
                greaterThan: true

            },
        },

        messages: {

            'name': {
                required: "Enter email",
            },
            'email': {
                required: "Enter email ID",
                email: "Enter valid email"
            },
            'phone': {
                required: "Enter mobile number",
            },
            'gender': {
                required: "Select gender",
            },
            'location': {
                required: "Enter your location",
            },
            'date': {
                required: "Enter date",
            },
            'address': {
                required: "Enter address",
            }



        },
        submitHandler: function (form) {
            form.submit();
        }
    });
    function setAttr() {
        var d = new Date();
        var curr_date = d.getDate();
        var curr_month = d.getMonth() + 1; //Months are zero based
        if (curr_month < 10)
            curr_month = '0' + curr_month;

        if (curr_date < 10)
            curr_date = '0' + curr_date;

        var curr_year = d.getFullYear();
        var d1 = curr_year + "-" + curr_month + "-" + curr_date;
        //console.log(d1);
        document.getElementById("date").setAttribute("max", d1);


    };
    $(document).on("change", ".uploadProfileInput", function () {
        var triggerInput = this;
        var currentImg = $(this).closest(".pic-holder").find(".pic").attr("src");
        var holder = $(this).closest(".pic-holder");
        var wrapper = $(this).closest(".profile-pic-wrapper");
        $(wrapper).find('[role="alert"]').remove();
        triggerInput.blur();
        var files = !!this.files ? this.files : [];
        if (!files.length || !window.FileReader) {
            return;
        }
        if (/^image/.test(files[0].type)) {
            // only image file
            var reader = new FileReader(); // instance of the FileReader
            reader.readAsDataURL(files[0]); // read the local file

            reader.onloadend = function () {
                $(holder).addClass("uploadInProgress");
                $(holder).find(".pic").attr("src", this.result);
                $(holder).append(
                    '<div class="upload-loader"><div class="spinner-border text-primary" role="status"><span class="sr-only">Loading...</span></div></div>'
                );

                // Dummy timeout; call API or AJAX below
                setTimeout(() => {
                    $(holder).removeClass("uploadInProgress");
                    $(holder).find(".upload-loader").remove();
                    // If upload successful
                    if (Math.random() < 0.9) {
                        $(wrapper).append(
                            '<div class="snackbar show" role="alert"><i class="fa fa-check-circle text-success"></i> Profile image updated successfully</div>'
                        );

                        // Clear input after upload
                        $(triggerInput).val("");

                        setTimeout(() => {
                            $(wrapper).find('[role="alert"]').remove();
                        }, 3000);
                    } else {
                        $(holder).find(".pic").attr("src", currentImg);
                        $(wrapper).append(
                            '<div class="snackbar show" role="alert"><i class="fa fa-times-circle text-danger"></i> There is an error while uploading! Please try again later.</div>'
                        );

                        // Clear input after upload
                        $(triggerInput).val("");
                        setTimeout(() => {
                            $(wrapper).find('[role="alert"]').remove();
                        }, 3000);
                    }
                }, 1500);
            };
        } else {
            $(wrapper).append(
                '<div class="alert alert-danger d-inline-block p-2 small" role="alert">Please choose the valid image.</div>'
            );
            setTimeout(() => {
                $(wrapper).find('role="alert"').remove();
            }, 3000);
        }
    });

</script>
{%endblock%}